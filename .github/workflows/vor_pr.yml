name: VOR PR Check

on:
    pull_request:
        branches: [main]
    push:
        branches: [main]

jobs:
    test:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                  python-version: "3.11"

            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install -e .[dev]

            - name: Run pytest
              run: pytest -v

            - name: Validate public_demo pack
              run: neuralogix pack validate --pack data/packs/public_demo_v0_7_1

            - name: Validate adversarial pack
              run: neuralogix pack validate --pack data/packs/adversarial_v1

            - name: Run VOR audit
              run: |
                  neuralogix audit --fast 2>&1 | tee audit_output.txt
                  # Fail if hallucination > 0
                  if grep -q "Hallucination (Max): 0.00%" audit_output.txt; then
                    echo "✅ Audit passed: 0% hallucination"
                  else
                    echo "❌ Audit failed: hallucination detected"
                    exit 1
                  fi
